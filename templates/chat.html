<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Medical Chatbox</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #000000;
      --bot-bubble: #f1f1f1;
      --user-bubble: #007bff;
      --user-text: #ffffff;
    }

    body.dark-mode {
      --bg-color: #121212;
      --text-color: #f5f5f5;
      --bot-bubble: #333333;
      --user-bubble: #0d6efd;
      --user-text: #ffffff;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: all 0.3s ease;
    }

    .chat-box {
      background-color: var(--bot-bubble);
      padding: 1rem;
      border-radius: 10px;
      height: 400px;
      overflow-y: auto;
      display: flex;
      flex-direction: column; /* ✅ ChatGPT style: top to bottom */
      margin-bottom: 1rem;
    }

    .chat-bubble {
      padding: 10px 15px;
      border-radius: 15px;
      margin: 5px 0;
      max-width: 75%;
      word-wrap: break-word;
    }

    .bot {
      background-color: var(--bot-bubble);
      color: var(--text-color);
      align-self: flex-start;
    }

    .user {
      background-color: var(--user-bubble);
      color: var(--user-text);
      align-self: flex-end;
    }

    .top-right-toggle {
      position: absolute;
      top: 1rem;
      right: 1rem;
    }

    .btn-small {
      padding: 5px 10px;
      font-size: 0.875rem;
    }
  </style>
</head>
<body>
  <!-- 🌗 Theme Toggle -->
  <div class="top-right-toggle">
    <button id="themeToggle" class="btn btn-outline-secondary btn-small">🌙 Dark Mode</button>
  </div>

  <div class="container py-5">
    <h2 class="mb-4 text-center">💬 Medical Chatbox</h2>

    <div class="chat-box" id="chatBox">
      {% for sender, message in conversation %}
        {% if sender == '🧑 You' %}
          <div class="chat-bubble user">{{ message }}</div>
        {% else %}
          <div class="chat-bubble bot">{{ message }}</div>
        {% endif %}
      {% endfor %}
    </div>

    <form id="chatForm" action="/" method="POST" class="d-flex gap-2 mb-3">
      <input type="text" name="user_input" class="form-control" placeholder="Ask a medical question..." required autofocus>
      <button type="submit" class="btn btn-success">Send</button>
      <button id="clearBtn" type="button" class="btn btn-danger">🧹 Clear</button>
    </form>
  </div>

  <script>
    const chatBox = document.getElementById("chatBox");
    const toggleBtn = document.getElementById("themeToggle");
    const body = document.body;

    // Restore theme from localStorage
    if (localStorage.getItem("theme") === "dark") {
      body.classList.add("dark-mode");
      toggleBtn.textContent = "☀️ Light Mode";
    }

    // Toggle theme and save in localStorage
    toggleBtn.addEventListener("click", () => {
      body.classList.toggle("dark-mode");
      const isDark = body.classList.contains("dark-mode");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      toggleBtn.textContent = isDark ? "☀️ Light Mode" : "🌙 Dark Mode";
    });

    // Scroll to latest message after DOM loads
    window.onload = () => {
      chatBox.scrollTop = chatBox.scrollHeight;
    };

    // Clear chat without reload
    document.getElementById('clearBtn').addEventListener('click', function () {
      fetch('/clear', { method: 'GET' })
        .then(() => {
          chatBox.innerHTML = '';
        });
    });
  </script>
</body>
</html>
